function BufferLoader(e,n,t){this.context=e,this.urlList=n,this.onload=t,this.bufferList=new Array,this.loadCount=0}function nextNote(){var e=60/tempo;nextNoteTime+=.25*e,current16thNote++,16==current16thNote&&(current16thNote=0)}function playSound(e,n,t){var i=context.createBufferSource();i.buffer=e,onlyplaypizzi===!0?"hum_base"===t?(gainNode.hum_base_filter=context.createBiquadFilter(),gainNode.hum_base=context.createGain(),gainNode.hum_base_filter.connect(gainNode.hum_base),i.connect(gainNode.hum_base),gainNode.hum_base.connect(context.destination),gainNode.hum_base_filter.type="notch",gainNode.hum_base_filter.frequency.value=1075,gainNode.hum_base.gain.value=.25):"drums_relaxed"===t&&(gainNode.drums_relaxed=context.createGain(),i.connect(gainNode.drums_relaxed),gainNode.drums_relaxed.connect(context.destination),gainNode.drums_relaxed.gain.value=.25):"hum_base"===t?(gainNode.hum_base_filter=context.createBiquadFilter(),gainNode.hum_base=context.createGain(),gainNode.hum_base_filter.connect(gainNode.hum_base),i.connect(gainNode.hum_base_filter),gainNode.hum_base.connect(context.destination),gainNode.hum_base_filter.type="lowpass",gainNode.hum_base_filter.frequency.value=interactions.hum_base_filter,gainNode.hum_base.gain.value=.65):"real_pizzicato"===t?(gainNode.real_pizzicato_filter=context.createBiquadFilter(),gainNode.real_pizzicato=context.createGain(),gainNode.real_pizzicato_filter.connect(gainNode.real_pizzicato),i.connect(gainNode.real_pizzicato_filter),gainNode.real_pizzicato.connect(context.destination),gainNode.real_pizzicato_filter.type="highpass",gainNode.real_pizzicato_filter.frequency.value=interactions.real_pizzicato_filter,gainNode.real_pizzicato.gain.value=.5):"drums_relaxed"===t?(gainNode.drums_relaxed=context.createGain(),i.connect(gainNode.drums_relaxed),gainNode.drums_relaxed.connect(context.destination),gainNode.drums_relaxed.gain.value=playAway===!0?0:.75):"drums_excited"===t?(gainNode.drums_excited=context.createGain(),i.connect(gainNode.drums_excited),gainNode.drums_excited.connect(context.destination),gainNode.drums_excited.gain.value=playAway===!0?.75:0):i.connect(context.destination),i.start(n)}function scheduleNote(e,n){notesInQueue.push({note:e,time:n});var t=0;e%16===0&&queueActive(),e%4===0?runKick():e%2===0&&runSnare()}function queueActive(){playSound(stems[1],0,"drums_relaxed"),playAway&&(playSound(stems[0],0,"real_pizzicato"),playSound(stems[2],0,"hum_base"),playSound(stems[3],0,"drums_excited")),$.each(track_functions,function(e,n){n()}),track_functions=[]}function runKick(){kick_elements.toggleClass("kick"),$.each(kick_functions,function(e,n){n()}),kick_functions=[]}function runSnare(){snare_elements.toggleClass("snare"),$.each(snare_functions,function(e,n){n()}),snare_functions=[]}function scheduler(){for(;nextNoteTime<context.currentTime+scheduleAheadTime;)scheduleNote(current16thNote,nextNoteTime),nextNote();timerID=window.setTimeout(scheduler,lookahead)}function play(){return isPlaying=!isPlaying,isPlaying?(current16thNote=0,nextNoteTime=context.currentTime,scheduler(),"stop"):(window.clearTimeout(timerID),"play")}function init(){var e=document.createElement("div");window.context=window.context||window.webkitcontext,context=new AudioContext,bufferLoader=new BufferLoader(context,["moth_stems/real_pizzicato.mp3","moth_stems/drums_relaxed.mp3","moth_stems/hum_base.mp3","moth_stems/drums_excited.mp3"],finishedLoading),bufferLoader.load()}function finishedLoading(e){stems=e,play()}function accelerationUpdates(e,n,t,i,a){playAway&&(null!==gainNode.hum_base&&(frequency=i,gainNode.hum_base_filter.frequency.value=2*frequency,interactions.hum_base=frequency),null!==gainNode.real_pizzicato&&(frequency=t,gainNode.real_pizzicato_filter.frequency.value=2*frequency,interactions.real_pizzicato=frequency)),$("#home").css("transform","translate("+e/60*-1+"%, "+n/30*-1+"%)"),$("#portfolio, #resume, #ideas, #inspirations").css("transform","translate("+e/80*-1+"%, "+n/60*-1+"%)"),$(".subtle-parallax").css("transform","translate("+e/60*-1+"%, "+n/30*-1+"%)"),1==$("#debug").length&&($("#x-pos .value","#debug").text(e),$("#y-pos .value","#debug").text(n),$("#x-half-pos .value","#debug").text(t),$("#y-half-pos .value","#debug").text(i),$("#x-half-per .value","#debug").text(e),$("#y-half-per .value","#debug").text(n))}var context=null,isPlaying=!1,startTime,current16thNote,tempo=58.81,lookahead=25,scheduleAheadTime=.0125,nextNoteTime=0,noteResolution=2,noteLength=.4,timerID=0,canvas,canvasContext,last16thNoteDrawn=-1,notesInQueue=[],playAway=!1,kick_elements=null,snare_elements=null,kick_functions=[],snare_functions=[],track_functions=[],onlyplaypizzi=!1,getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=n.exec(location.search);return null==t?"":decodeURIComponent(t[1].replace(/\+/g," "))},bufferLoader,stems,gainNode={hum_base:null,hum_base_filter:null,real_pizzicato:null,real_pizzicato_filter:null,drums_relaxed:null,drums_excited:null},interactions={hum_base:1,real_pizzicato:1,drums_relaxed:1,drums_excited:1};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),BufferLoader.prototype.loadBuffer=function(e,n){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer";var i=this;t.onload=function(){i.context.decodeAudioData(t.response,function(t){return t?(i.bufferList[n]=t,void(++i.loadCount==i.urlList.length&&i.onload(i.bufferList))):void alert("error decoding file data: "+e)},function(e){console.error("decodeAudioData error",e)})},t.onerror=function(){alert("BufferLoader: XHR error")},t.send()},BufferLoader.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)},window.addEventListener("load",init);var mobileInit=0;$(document).ready(function(){function e(e){var n="visible",t="hidden",i={focus:n,focusin:n,pageshow:n,blur:t,focusout:t,pagehide:t};e=e||window.event,onlyplaypizzi=e.type in i?!onlyplaypizzi:!onlyplaypizzi}kick_elements=$("[data-kick]"),snare_elements=$("[data-snare]"),getParameterByName("trigger")&&(track_functions[track_functions.length]=function(){kick_functions[kick_functions.length]=function(){$("[data-activate=#"+getParameterByName("trigger")+"]").trigger("click")}}),$(document).pjax(".pjax","#pjax-container"),$(document).on("pjax:complete",function(){kick_elements=$("[data-kick]"),snare_elements=$("[data-snare]")}),setTimeout(function(){$("#initial-intro").show(),setTimeout(function(){$("#initial-intro").hide()},6e3)},1e3),Modernizr.touch&&1!==mobileInit&&$("html").one("click",function(){isPlaying=!1,play(),mobileInit=1}),Modernizr.touch?window.ondeviceorientation=function(e){var n=Math.ceil(10*e.gamma),t=Math.ceil(10*e.beta),i=n-$("#center").offset().left+$(window).scrollLeft(),a=t-$("#center").offset().top+$(window).scrollTop(),o=-i>0?0:i,r=-a>0?0:a;accelerationUpdates(i,a,o,r,e)}:$("html").mousemove(function(e){var n=e.clientX-$("#center").offset().left+$(window).scrollLeft(),t=e.clientY-$("#center").offset().top+$(window).scrollTop(),i=-n>0?-n:n,a=-t>0?-t:t;i=i/$(window).innerWidth()*4e3,a=a/$(window).innerHeight()*4e3,accelerationUpdates(n,t,i,a,e)}),$(".stripe").on("click",function(){var e=$(this).attr("data-activate");$("#home").hasClass("spread")?(track_functions[track_functions.length]=function(){$(e).addClass("animated")},snare_functions[snare_functions.length]=function(){$(".panel").not($(e)).removeClass("animated"),kick_functions[kick_functions.length]=function(){$(e).addClass("animated")}}):(window.playAway=!window.playAway,$("#home").hide(),track_functions[track_functions.length]=function(){$(e).addClass("animated"),$(".alert").hide(),$("#first-intro[data-init]").show(),setTimeout(function(){$("#first-intro[data-init]").removeAttr("data-init").hide()},6e3),$("#home").toggleClass("spread").show(),$(".stripe").removeClass("animated bounceInLeft bounceInRight")},snare_functions[snare_functions.length]=function(){},kick_functions[kick_functions.length]=function(){$(".panel").not($(e)).removeClass("animated")})});var n="hidden";n in document?document.addEventListener("visibilitychange",e):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(n="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(n="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e,$(document).keyup(function(e){27==e.keyCode&&($("#pjax-container").addClass("animated bounceOutDown"),$("#home").hasClass("spread")&&($(".bounceInLeft").addClass("animated bounceOutRight"),$(".bounceInRight").addClass("animated bounceOutLeft"),window.playAway=!window.playAway,history.pushState({},"","/"),track_functions[track_functions.length]=function(){$("#home").toggleClass("spread"),$(".panel").removeClass("animated"),$("#pjax-container").removeClass("animated bounceOutDown")}))})});