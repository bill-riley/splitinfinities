function BufferLoader(e,n,t){this.context=e,this.urlList=n,this.onload=t,this.bufferList=new Array,this.loadCount=0}function nextNote(){var e=60/tempo;nextNoteTime+=.25*e,current16thNote++,16==current16thNote&&(current16thNote=0)}function playSound(e,n,t){var o=context.createBufferSource();o.buffer=e,"kick"===t?(gainNode.kick=context.createBiquadFilter(),o.connect(gainNode.kick),gainNode.kick.connect(context.destination),gainNode.kick.type="bandpass",gainNode.kick.frequency.value=interactions.kickVolume,gainNode.kick.gain.value=.5):"highhum"===t?(gainNode.highhum=context.createBiquadFilter(),o.connect(gainNode.highhum),gainNode.highhum.connect(context.destination),gainNode.highhum.type="lowshelf",gainNode.highhum.frequency.value=interactions.highhumVolume,gainNode.highhum.gain.value=.5):"hum"===t?(gainNode.hum=context.createGain,o.connect(context.destination)):o.connect(context.destination),o.start(n)}function scheduleNote(e,n){notesInQueue.push({note:e,time:n});var t=0;e%16===0&&queueActive(),e%4===0?runKick():e%2===0&&runSnare()}function queueActive(){playSound(stems[1],0,"hum"),playAway&&(playSound(stems[0],0,"kick"),playSound(stems[2],0,"highhum")),$.each(track_functions,function(e,n){n()}),track_functions=[]}function runKick(){kick_elements.toggleClass("kick"),$.each(kick_functions,function(e,n){n()}),kick_functions=[]}function runSnare(){snare_elements.toggleClass("snare"),$.each(snare_functions,function(e,n){n()}),snare_functions=[]}function scheduler(){for(;nextNoteTime<context.currentTime+scheduleAheadTime;)scheduleNote(current16thNote,nextNoteTime),nextNote();timerID=window.setTimeout(scheduler,lookahead)}function play(){return isPlaying=!isPlaying,isPlaying?(current16thNote=0,nextNoteTime=context.currentTime,scheduler(),"stop"):(window.clearTimeout(timerID),"play")}function init(){var e=document.createElement("div");window.context=window.context||window.webkitcontext,context=new AudioContext,bufferLoader=new BufferLoader(context,["moth_stems/hum_high.mp3","moth_stems/drums_excited.mp3","moth_stems/hum_base.mp3"],finishedLoading),bufferLoader.load()}function finishedLoading(e){stems=e,play()}function accelerationUpdates(e,n,t,o,i){playAway&&(null!==gainNode.kick&&(kickVolume=o,gainNode.kick.frequency.value=kickVolume,interactions.kickVolume=kickVolume),null!==gainNode.highhum&&(highhumVolume=t,gainNode.highhum.frequency.value=highhumVolume,interactions.highhumVolume=highhumVolume)),$("#home").css("transform","translate("+e/60*-1+"%, "+n/30*-1+"%)"),$("#portfolio, #resume, #ideas, #inspirations").css("transform","translate("+e/80*-1+"%, "+n/60*-1+"%)"),1==$("#debug").length&&($("#x-pos .value","#debug").text(e),$("#y-pos .value","#debug").text(n),$("#x-half-pos .value","#debug").text(t),$("#y-half-pos .value","#debug").text(o),$("#x-half-per .value","#debug").text(e),$("#y-half-per .value","#debug").text(n))}var context=null,isPlaying=!1,startTime,current16thNote,tempo=58.81,lookahead=25,scheduleAheadTime=.025,nextNoteTime=0,noteResolution=2,noteLength=.1,timerID=0,canvas,canvasContext,last16thNoteDrawn=-1,notesInQueue=[],playAway=!1,kick_elements=null,snare_elements=null,kick_functions=[],snare_functions=[],track_functions=[],bufferLoader,stems,gainNode={kick:null,highhum:null},interactions={kickVolume:.5,highhumVolume:.5};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),BufferLoader.prototype.loadBuffer=function(e,n){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer";var o=this;t.onload=function(){o.context.decodeAudioData(t.response,function(t){return t?(o.bufferList[n]=t,void(++o.loadCount==o.urlList.length&&o.onload(o.bufferList))):void alert("error decoding file data: "+e)},function(e){console.error("decodeAudioData error",e)})},t.onerror=function(){alert("BufferLoader: XHR error")},t.send()},BufferLoader.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)},window.addEventListener("load",init);var mobileInit=0;$(document).ready(function(){function e(e){var n="visible",t="hidden",o={focus:n,focusin:n,pageshow:n,blur:t,focusout:t,pagehide:t};e=e||window.event,e.type in o,play()}kick_elements=$("[data-kick]"),snare_elements=$("[data-snare]"),Modernizr.touch&&1!==mobileInit&&$("html").one("click",function(){isPlaying=!1,play(),mobileInit=1}),Modernizr.touch?window.ondeviceorientation=function(e){var n=Math.ceil(50*e.gamma),t=Math.ceil(10*e.beta),o=n-$("#center").offset().left+$(window).scrollLeft(),i=t-$("#center").offset().top+$(window).scrollTop(),a=o,u=i;accelerationUpdates(o,i,a,u,e)}:$("html").mousemove(function(e){var n=e.clientX-$("#center").offset().left+$(window).scrollLeft(),t=e.clientY-$("#center").offset().top+$(window).scrollTop(),o=-n>0?-n:n,i=-t>0?-t:t;o=n/$(window).innerWidth()*3e3,i=t/$(window).innerHeight()*3e3,accelerationUpdates(n,t,o,i,e)}),$(".stripe").on("click",function(){var e=$(this).attr("data-activate");$("#home").hasClass("spread")||($(".bounceInLeft").addClass("animated bounceOutRight"),$(".bounceInRight").addClass("animated bounceOutLeft"),window.playAway=!window.playAway,track_functions[track_functions.length]=function(){$("#home").toggleClass("spread"),$(".bounceInRight, .bounceInLeft, .bounceOutRight, .bounceOutLeft").removeClass("animated bounceInRight bounceInLeft bounceOutLeft bounceOutRight"),$(e).addClass("animated")},snare_functions[snare_functions.length]=function(){},kick_functions[kick_functions.length]=function(){$(".panel").not($(e)).removeClass("animated")})});var n="hidden";n in document?document.addEventListener("visibilitychange",e):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(n="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(n="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e,$(document).keyup(function(e){27==e.keyCode&&$("#home").hasClass("spread")&&($(".bounceInLeft").addClass("animated bounceOutRight"),$(".bounceInRight").addClass("animated bounceOutLeft"),window.playAway=!window.playAway,track_functions[track_functions.length]=function(){$("#home").toggleClass("spread"),$(".panel").removeClass("animated")})})});