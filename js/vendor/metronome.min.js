function BufferLoader(e,n,t){this.context=e,this.urlList=n,this.onload=t,this.bufferList=new Array,this.loadCount=0}function nextNote(){var e=60/tempo;nextNoteTime+=.25*e,current16thNote++,16==current16thNote&&(current16thNote=0)}function playSound(e,n,t){var o=context.createBufferSource();o.buffer=e,"kick"===t?(gainNode.kick=context.createBiquadFilter(),o.connect(gainNode.kick),gainNode.kick.connect(context.destination),gainNode.kick.type="bandpass",gainNode.kick.frequency.value=interactions.kickVolume):"highhum"===t?(gainNode.highhum=context.createBiquadFilter(),o.connect(gainNode.highhum),gainNode.highhum.connect(context.destination),gainNode.highhum.type="lowshelf",gainNode.highhum.frequency.value=-interactions.highhumVolume):o.connect(context.destination),o.start(n)}function scheduleNote(e,n){notesInQueue.push({note:e,time:n});var t=0;e%16===0&&queueActive(),e%4===0?runKick():e%2===0&&runSnare()}function queueActive(){playSound(stems[1],0,"hum"),playAway&&(playSound(stems[0],0,"kick"),playSound(stems[2],0,"highhum")),$.each(track_functions,function(e,n){n()}),track_functions=[]}function runKick(){kick_elements.toggleClass("kick"),$.each(kick_functions,function(e,n){n()}),kick_functions=[]}function runSnare(){snare_elements.toggleClass("snare"),$.each(snare_functions,function(e,n){n()}),snare_functions=[]}function scheduler(){for(;nextNoteTime<context.currentTime+scheduleAheadTime;)scheduleNote(current16thNote,nextNoteTime),nextNote();timerID=window.setTimeout(scheduler,lookahead)}function play(){return isPlaying=!isPlaying,isPlaying?(current16thNote=0,nextNoteTime=context.currentTime,scheduler(),"stop"):(window.clearTimeout(timerID),"play")}function init(){var e=document.createElement("div");window.context=window.context||window.webkitcontext,context=new AudioContext,bufferLoader=new BufferLoader(context,["moth_stems/hum_high.mp3","moth_stems/drums_excited.mp3","moth_stems/hum_base.mp3"],finishedLoading),bufferLoader.load()}function finishedLoading(e){stems=e,play()}var context=null,isPlaying=!1,startTime,current16thNote,tempo=58.81,lookahead=25,scheduleAheadTime=.1,nextNoteTime=0,noteResolution=2,noteLength=.1,timerID=0,canvas,canvasContext,last16thNoteDrawn=-1,notesInQueue=[],playAway=!1,kick_elements=null,snare_elements=null,kick_functions=[],snare_functions=[],track_functions=[],bufferLoader,stems,gainNode={kick:null,highhum:null},interactions={kickVolume:0,highhumVolume:0};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),BufferLoader.prototype.loadBuffer=function(e,n){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer";var o=this;t.onload=function(){o.context.decodeAudioData(t.response,function(t){return t?(o.bufferList[n]=t,void(++o.loadCount==o.urlList.length&&o.onload(o.bufferList))):void alert("error decoding file data: "+e)},function(e){console.error("decodeAudioData error",e)})},t.onerror=function(){alert("BufferLoader: XHR error")},t.send()},BufferLoader.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)},window.addEventListener("load",init),$(document).ready(function(){function e(e){var n="visible",t="hidden",o={focus:n,focusin:n,pageshow:n,blur:t,focusout:t,pagehide:t};e=e||window.event,e.type in o,play()}kick_elements=$("[data-kick]"),snare_elements=$("[data-snare]"),$("html").mousemove(function(e){var n=e.clientX-$("#center").offset().left+$(window).scrollLeft(),t=e.clientY-$("#center").offset().top+$(window).scrollTop();n=-n>0?-n:n,t=-t>0?-t:t,n=n/$(window).innerWidth()*3e3,t=t/$(window).innerHeight()*3e3,playAway&&(null!==gainNode.kick&&(kickVolume=t,gainNode.kick.frequency.value=kickVolume,interactions.kickVolume=kickVolume),null!==gainNode.highhum&&(highhumVolume=n,gainNode.highhum.frequency.value=highhumVolume,interactions.highhumVolume=highhumVolume)),1==$("#debug").length&&($("#x-pos .value","#debug").text(e.clientX),$("#y-pos .value","#debug").text(e.clientY),$("#x-half-pos .value","#debug").text(e.clientX/$(window).innerWidth()),$("#y-half-pos .value","#debug").text(e.clientY/$(window).innerHeight()),$("#x-half-per .value","#debug").text(n),$("#y-half-per .value","#debug").text(t))}),$(".stripe").on("click",function(){$("#home").hasClass("spread")||($(".bounceInLeft").addClass("animated bounceOutRight"),$(".bounceInRight").addClass("animated bounceOutLeft"),window.playAway=!window.playAway,track_functions[track_functions.length]=function(){$("#home").toggleClass("spread"),$(".bounceInRight, .bounceInLeft, .bounceOutRight, .bounceOutLeft ").removeClass("animated bounceInRight bounceInLeft bounceOutLeft bounceOutRight")})});var n="hidden";n in document?document.addEventListener("visibilitychange",e):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(n="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(n="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e,$(document).keyup(function(e){27==e.keyCode&&$("#home").hasClass("spread")&&($(".bounceInLeft").addClass("animated bounceOutRight"),$(".bounceInRight").addClass("animated bounceOutLeft"),window.playAway=!window.playAway,track_functions[track_functions.length]=function(){$("#home").toggleClass("spread"),$(".bounceInRight, .bounceInLeft, .bounceOutRight, .bounceOutLeft ").removeClass("animated bounceInRight bounceInLeft bounceOutLeft bounceOutRight")})})});